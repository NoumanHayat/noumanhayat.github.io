<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Scrape Text by ID (Frontend Only with CORS Proxy)</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #f5f7fa;
        color: #333;
        padding: 20px;
        max-width: 700px;
        margin: 0 auto;
      }
      h2 {
        text-align: center;
        color: #0078d4;
      }
      input,
      button {
        width: 100%;
        padding: 10px;
        font-size: 16px;
        margin: 8px 0;
        box-sizing: border-box;
      }
      button {
        background: #0078d4;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 5px;
        transition: background 0.3s;
      }
      button:hover {
        background: #005fa3;
      }
      #navButtons {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        margin-top: 5px;
      }
      #copyBtn {
        margin-top: 10px;
        background: #28a745;
      }
      #HistoryBtn {
        margin-top: 10px;
        background: #ed0505;
      }
      #copyBtn:hover {
        background: #1e7e34;
      }
      #output {
        margin-top: 20px;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        min-height: 120px;
        white-space: pre-wrap;
        overflow-wrap: break-word;
      }
      #history {
        margin-top: 25px;
        background: #fff;
        padding: 10px;
        border-radius: 8px;
        box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
      }
      #history h3 {
        margin-top: 0;
        color: #0078d4;
      }
      #history ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }
      #history li {
        padding: 5px 0;
        cursor: pointer;
        color: #0078d4;
        text-decoration: underline;
      }
      #history li:hover {
        color: #005fa3;
      }
      #clearHistoryBtn {
        margin-top: 10px;
        background: #dc3545;
      }
      #clearHistoryBtn:hover {
        background: #b52a37;
      }
    </style>
  </head>
  <body>
    <h2>Scrape text from specific element ID</h2>

    <input
      type="text"
      id="idInput"
      placeholder="Enter an ID (default: article)"
    />
    <input type="text" id="urlInput" placeholder="Enter a URL (https://...)" />

    <div id="navButtons">
      <button id="HistoryBtn">üìã History</button>
      <button id="scrapeBtn">Scrape Text</button>
    </div>

    <div id="navButtons">
      <button id="prevBtn">‚¨ÖÔ∏è Previous</button>
      <button id="nextBtn">‚û°Ô∏è Next</button>
    </div>

    <button id="copyBtn">üìã Copy Text</button>

    <div id="output">Result will appear here...</div>

    <div id="history">
      <h3>History</h3>
      <ul id="historyList"></ul>
      <button id="clearHistoryBtn">üóëÔ∏è Clear History</button>
    </div>

    <script>
      const historyBtn = document.getElementById("HistoryBtn");
      const historyDiv = document.getElementById("history");
      const outputDiv = document.getElementById("output");

      // Initially show output and hide history
      historyDiv.style.display = "none";
      outputDiv.style.display = "block";

      historyBtn.addEventListener("click", () => {
        if (historyDiv.style.display === "none") {
          // Show history, hide output
          historyDiv.style.display = "block";
          outputDiv.style.display = "none";
        } else {
          // Show output, hide history
          historyDiv.style.display = "none";
          outputDiv.style.display = "block";
        }
      });

      async function scrapeContent() {
        const url = document.getElementById("urlInput").value.trim();
        const idValue = document.getElementById("idInput").value.trim();
        const output = document.getElementById("output");

        if (!url) {
          output.textContent = "‚ö†Ô∏è Please enter a valid URL.";
          return;
        }

        output.textContent = "‚è≥ Fetching content...";
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(
          url
        )}`;

        try {
          const response = await fetch(proxyUrl);
          if (!response.ok)
            throw new Error(
              "Failed to fetch (proxy or target may block requests)"
            );
          const data = await response.json();
          const html = data.contents;

          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          const targetId = idValue || "article";

          if (targetId == "1") {
            const element = doc.body;

            if (element) {
              let text =
                element.textContent.trim() || "‚ÑπÔ∏è Element found but empty.";
              text = text.replace(/^\s*[\r\n]/gm, "");

              output.textContent = text;

              // Save URL in history
              saveHistory(url);
              displayHistory();
            } else {
              output.textContent = `‚ùå No element found with id='${targetId}'. Please check the ID and try again.`;
            }
          } else {
            const element = doc.getElementById(targetId);

            if (element) {
              let text =
                element.textContent.trim() || "‚ÑπÔ∏è Element found but empty.";
              text = text;
              text = text
                // remove ad or pub-related JavaScript blocks
                .replace(
                  /var\s+adx_id_\d+\s*=\s*document\.getElementById[\s\S]*?window\.pubadxtag\.push\([^)]*\);?/g,
                  ""
                )
                .replace(
                  /window\.pubadxtag\s*=\s*window\.pubadxtag\s*\|\|\s*\[\];?/g,
                  ""
                )
                .replace(/[^a-zA-Z0-9."\n]+/g, " ")
                .replace(/\n{2,}/g, "\n\n")
                .replace("ùíáùôßùôöùôöùô¨ùôöùì´ùíèùì∏ùìøùìÆùíç.ùì¨ùô§ùì∂", "");

              output.textContent = text;

              // Save URL in history
              saveHistory(url);
              displayHistory();
            } else {
              output.textContent = `‚ùå No element found with id='${targetId}'. Please check the ID and try again.`;
            }
          }
        } catch (err) {
          output.textContent = `üö´ Error: ${err.message}`;
        }
      }

      // Save and display history
      function saveHistory(url) {
        let history = JSON.parse(localStorage.getItem("urlHistory")) || [];
        if (!history.includes(url)) {
          history.push(url);
          localStorage.setItem("urlHistory", JSON.stringify(history));
        }
      }

      function displayHistory() {
        const history = JSON.parse(localStorage.getItem("urlHistory")) || [];
        const list = document.getElementById("historyList");
        list.innerHTML = "";

        if (history.length === 0) {
          list.innerHTML = "<li>No history found.</li>";
        } else {
          history
            .slice()
            .reverse()
            .forEach((u) => {
              const li = document.createElement("li");
              li.textContent = u;
              li.onclick = () => {
                document.getElementById("urlInput").value = u;
                scrapeContent();
              };
              list.appendChild(li);
            });
        }
      }

      // Clear history
      function clearHistory() {
        localStorage.removeItem("urlHistory");
        displayHistory();
      }

     
      function changeChapter(direction) {
        const urlInput = document.getElementById("urlInput");
        const currentUrl = urlInput.value.trim();

        // Match chapter-123 or _123.html
        const matchChapterDash = currentUrl.match(/chapter-(\d+)/);
        const matchHtmlNumber = currentUrl.match(/_(\d+)\.html/);

        let chapterNum;

        if (matchChapterDash) {
          chapterNum = parseInt(matchChapterDash[1]);
        } else if (matchHtmlNumber) {
          chapterNum = parseInt(matchHtmlNumber[1]);
        } else {
          alert("‚ùå No chapter number found in the URL!");
          return;
        }

        chapterNum += direction;

        if (chapterNum < 1) {
          alert("üö´ Chapter number cannot be less than 1!");
          return;
        }

        let newUrl = currentUrl;

        if (matchChapterDash) {
          newUrl = currentUrl.replace(/chapter-\d+/, `chapter-${chapterNum}`);
        } else if (matchHtmlNumber) {
          newUrl = currentUrl.replace(/_(\d+)\.html/, `_${chapterNum}.html`);
        }

        urlInput.value = newUrl;
        scrapeContent();
      }

      // Copy text
      function copyText() {
        const text = document.getElementById("output").textContent.trim();
        if (!text || text === "Result will appear here...") {
          alert("‚ö†Ô∏è Nothing to copy!");
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => alert("‚úÖ Text copied to clipboard!"))
          .catch(() => alert("‚ùå Failed to copy text."));
      }

      // Event listeners
      document
        .getElementById("scrapeBtn")
        .addEventListener("click", scrapeContent);
      document
        .getElementById("nextBtn")
        .addEventListener("click", () => changeChapter(1));
      document
        .getElementById("prevBtn")
        .addEventListener("click", () => changeChapter(-1));
      document.getElementById("copyBtn").addEventListener("click", copyText);
      document
        .getElementById("clearHistoryBtn")
        .addEventListener("click", clearHistory);

      // Load history on startup
      displayHistory();
    </script>
  </body>
</html>
